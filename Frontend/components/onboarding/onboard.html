<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Openxp - Onboarding</title>
    <!-- Tailwind CDN (GLOBAL) -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/typography.css" />
    <style>
      body {
        font-family: "Open Sans", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", Arial, sans-serif;
      }
    </style>
  </head>
  <body class="bg-[#F5F7FB]">                  
    <section class="min-h-screen grid grid-cols-1 md:grid-cols-2 overflow-x-hidden">
      <!-- LEFT: form -->
      <div class="w-full min-w-0 flex flex-col gap-4 px-8 md:px-20 lg:px-24 py-12 bg-[#F5F7FB]">
        <a href="/index.html">
          <img src="/Images/purple.png" alt="Openxp Logo" class="h-auto w-30" />
        </a>
        <h1 class="text-black h1">Create an account</h1>
        <p class="text-black body-md">
          Let’s start a Glorious examination preparation journey together!
        </p>

        <form id="signup-form" class="flex flex-col gap-6 mt-6">
          <input
            id="fullName"
            type="text"
            placeholder="Full Name"
            class="w-full px-4 py-3 border bg-white border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2B0A6B]"
          />

          <input
            id="email"
            type="email"
            placeholder="Email Address"
            class="w-full px-4 py-3 border bg-white border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2B0A6B]"
          />

          <input
            id="username"
            type="text"
            placeholder="Username"
            class="w-full px-4 py-3 border bg-white border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2B0A6B]"
          />

          <!-- Password visual-test wrapper -->
          <div class="relative w-full h-11">
            <input
              id="password"
              type="password"
              placeholder="Password"
              class="w-full h-full px-4 pr-12 border bg-white border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#2B0A6B]"
            />

            <!-- Eye button (layout only, no JS) -->
            <button
              type="button"
              class="absolute right-3 top-0 bottom-0 flex items-center text-gray-500 hover:text-gray-700"
              aria-label="Toggle password visibility"
            >
              <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path
                  d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7-10-7-10-7Z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
            </button>
          </div>

          <button
            type="submit"
            class="w-full bg-[#2B0A6B] text-white px-4 py-3 rounded-md hover:bg-[#3C127F] transition"
          >
            Sign Up
          </button>
        </form>
        <div id="signup-message" role="alert" class="mt-2 text-sm min-h-[1.25rem] px-3 py-2 rounded-md hidden" aria-live="polite"></div>

        <!-- Continue with Google -->
        <button
          type="button"
          class="mt-2 w-full flex items-center justify-center gap-3 px-4 py-3 border border-gray-300 rounded-md bg-white hover:bg-gray-50 transition"
        >
          <!-- Google icon -->
          <svg class="h-5 w-5" viewBox="    0 0 48 48" aria-hidden="true">
            <path
              fill="#FFC107"
              d="M43.6 20.5H42V20H24v8h11.3C33.7 32.7 29.3 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.2 6.1 29.4 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.1-.1-2.3-.4-3.5z"
            />
            <path
              fill="#FF3D00"
              d="M6.3 14.7l6.6 4.8C14.7 15.1 19 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C34.2 6.1 29.4 4 24 4 16.3 4 9.6 8.3 6.3 14.7z"
            />
            <path
              fill="#4CAF50"
              d="M24 44c5.2 0 10-2 13.6-5.2l-6.3-5.3C29.4 35.5 26.8 36 24 36c-5.3 0-9.8-3.4-11.4-8.1l-6.6 5.1C9.2 39.6 16.1 44 24 44z"
            />
            <path
              fill="#1976D2"
              d="M43.6 20.5H42V20H24v8h11.3c-.8 2.2-2.3 4.1-4.2 5.3l6.3 5.3C40.6 35.6 44 30.3 44 24c0-1.1-.1-2.3-.4-3.5z"
            />
          </svg>
          <span class="text-sm font-medium text-gray-700">Continue with Google</span>
        </button>

        <p class="mt-4 text-center text-sm text-gray-600">
          Already have an account?
          <a href="login.html" class="font-medium text-[#2B0A6B] hover:underline">Sign in</a>
        </p>
      </div>

      <!-- RIGHT: image -->
      <div class="block md:block relative bg-red-200 h-64 md:h-auto">
        <!-- if you see the red area, the grid is fine. if not, nesting/overflow is happening -->
        <img src="/Images/Classroom.png" alt="" class="absolute inset-0 w-full h-full object-cover" />
      </div>
    </section>

    <!-- Step 8: Supabase JS client (for Auth signUp) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // Replace with your values from Supabase Dashboard → Settings → API
      const SUPABASE_URL = 'https://nquzuszxlmycgftfbxno.supabase.co';   // e.g. https://xxxxx.supabase.co
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xdXp1c3p4bG15Y2dmdGZieG5vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNTk2OTQsImV4cCI6MjA4NzYzNTY5NH0.QyNjwy61dJfKbWS4Zl6dtIT-CYH_xr_ZykrWJOB7-QY';

      const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Eye icon toggle
      document.querySelector('[aria-label="Toggle password visibility"]').addEventListener('click', () => {
        const pwd = document.getElementById('password');
        pwd.type = pwd.type === 'password' ? 'text' : 'password';
      });

      document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value;

        const msgEl = document.getElementById('signup-message');
        msgEl.textContent = '';
        msgEl.className = 'mt-2 text-sm min-h-[1.25rem] px-3 py-2 rounded-md hidden';
        msgEl.classList.remove('bg-red-50', 'border-red-200', 'text-red-700', 'bg-green-50', 'border-green-200', 'text-green-700');

        function showError(msg) {
          msgEl.textContent = msg;
          msgEl.classList.remove('hidden', 'bg-green-50', 'border-green-200', 'text-green-700');
          msgEl.classList.add('bg-red-50', 'border', 'border-red-200', 'text-red-700');
        }

        function showSuccess(msg) {
          msgEl.textContent = msg;
          msgEl.classList.remove('hidden', 'bg-red-50', 'border-red-200', 'text-red-700');
          msgEl.classList.add('bg-green-50', 'border', 'border-green-200', 'text-green-700');
        }

        if (!fullName || !email || !username || !password) {
          showError('Please fill in all fields.');
          return;
        }

        const { data, error } = await supabaseClient.auth.signUp({
          email,
          password,
          options: {
            data: {
              full_name: fullName,
              username: username
            }
          }
        });

        if (error) {
          if (error.message && error.message.toLowerCase().includes('already registered')) {
            showError('An account with this email already exists. Try signing in.');
          } else {
            showError(error.message || 'Sign up failed. Please try again.');
          }
          return;
        }

        showSuccess('Account created! Check your email to confirm, then sign in.');
        setTimeout(() => { window.location.href = 'login.html'; }, 2500);
      });
    </script>
  </body>
</html>
